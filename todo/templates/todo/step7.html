<!DOCTYPE html>
<html>
  <head>
    <title>Todo</title>
  </head>

  <body>
    <h1>My Todo List</h1>
    <div id="tododiv">
      <ul id="todoul">
      </ul>
      <hr>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/addons/p5.dom.js"></script>
    <script>

var todos = [];

function preload(){
  var url = "{% url "todo:get_todo" %}";
  loadJSON(url, readJSON);
//  httpGet(url, "json", readJSON);

}

function setup(){

  showList();
}

function draw(){}

function readJSON(data){
  for(var item of data) {
    item.due = new Date(item.due);
    todos.push(item);
  }
}

function showList() {
  for(var item of todos) {
    var el = createElement("li", item.task);
    el.parent("todoul");
    el.mouseClicked(complete.bind(item,item));
    if(item.done){
      el.style("text-decoration: line-through; color: red");
    }
  }
}

function complete(item){
  item.done = !item.done;
  showList();
}


//
// var vm = new Vue({
//   delimiters: ['[[', ']]'],
//   el: '#app',
//   data: {
//     todos: [],
//     new_task: "",
//     its_due: ""
//   },
//   mounted: function() {
//     axios.get('{% url "todo:get_todo" %}')
//       .then(function (response) {
//         for(var d in response.data) {
//           var item = response.data[d];
//           item.due = new Date(item.due);
//           vm.todos.push(item);
//         }
//       })
//       .catch(function (error) {
//         console.log(error);
//       })
//       .then(function () {
//       });
//     },
//   methods: {
//     changeStatus: function(item) {
//       item.done = !item.done;
//       this.updateDB(item);
//     },
//     addTask: function() {
//       if(this.new_task && this.its_due){
//         item = {
//           "task":this.new_task,
//           "due": new Date(this.its_due),
//           "done":false
//         };
//         this.todos.push(item);
//         this.updateDB(item);
//       }
//       this.task = "";
//       this.due = "";
//     },
//     updateDB: function(item) {
//       csrftoken = Cookies.get('csrftoken');
//       headers = {'X-CSRFToken': csrftoken};
//       data = {
//           "task":item.task,
//           "due": new Date(item.due),
//           "done":item.done
//         };
//       axios.post('{% url "todo:post_todo" %}', data, {headers: headers})
//         .then(function (response) {
//           console.log(response);
//         })
//         .catch(function (error) {
//           console.log(error);
//         });
//     }
//   }
// })
//
    </script>
  </body>
</html>
